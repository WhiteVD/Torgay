<div id="app_container" [class.is-mobile]="mobileQuery.matches" class="nav-container">

  <mat-toolbar ngPreserveWhitespaces color="primary" class="app-toolbar">
    <button mat-icon-button class="toolbar-button" (click)="mainNav.toggle()">
      <mat-icon>menu</mat-icon>
    </button>
    <h1 class="app-name">
      <a routerLink="/" class="appTitle">
        {{appTitle}}
      </a>
    </h1>

    <span class="flex-auto"></span>
    <app-theme-picker tooltip="{{'mainMenu.Theme' | translate}}"></app-theme-picker>

    @if (isUserLoggedIn) {
      <button class="toolbar-button" mat-button [class.active]="isRouteActive('settings')"
              [matMenuTriggerFor]="accountMenu" matTooltip="{{'mainMenu.UserAccount' | translate}}">
        <mat-icon>account_circle</mat-icon>
        <!--<span class="hide-xs">{{'mainMenu.Account' | translate}}</span>-->
      </button>
    }
    @else {
      <button class="toolbar-button" mat-button routerLinkActive="active" routerLink="/login">
        <mat-icon>lock_open</mat-icon>
        <span>{{'mainMenu.Login' | translate}}</span>
      </button>
    }
    <mat-menu #accountMenu="matMenu">
      <button mat-menu-item (click)="router.navigateByUrl('/settings#profile')">
        <mat-icon>person</mat-icon><span>{{'mainMenu.Profile' | translate}}</span>
      </button>
      <button mat-menu-item (click)="router.navigateByUrl('/settings#preferences')">
        <mat-icon>settings</mat-icon><span>{{'mainMenu.Settings' | translate}}</span>
      </button>
      <button mat-menu-item (click)="logout()">
        <mat-icon>lock</mat-icon><span>{{'mainMenu.Logout' | translate}}</span>
      </button>
    </mat-menu>
  </mat-toolbar>

  <mat-sidenav-container class="app-sidenav-container" [style.marginTop.px]="mobileQuery.matches ? 56 : 0">
    <mat-sidenav #mainNav class="app-sidenav-nav" [mode]="mobileQuery.matches ? 'over' : 'side'"
                 [fixedInViewport]="mobileQuery.matches" fixedTopGap="56" [opened]="!mobileQuery.matches">
      @if (isUserLoggedIn) {
        <mat-nav-list>
          <a mat-list-item routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" routerLink="">
            <mat-icon matListItemIcon matTooltip="{{'mainMenu.Home' | translate}}" matTooltipPosition="right">pie_chart</mat-icon>
          </a>
          @if (canViewCustomers) {
            <a mat-list-item routerLinkActive="active" routerLink="/customers">
              <mat-icon matListItemIcon matTooltip="{{'mainMenu.Customers' | translate}}" matTooltipPosition="right">format_list_bulleted</mat-icon>
            </a>
          }
            <a mat-list-item routerLinkActive="active" routerLink="/catalogs">
              <mat-icon matListItemIcon matTooltip="{{'mainMenu.Catalogs' | translate}}" matTooltipPosition="right">calendar_today</mat-icon>
            </a>
          @if (canViewProducts) {
            <a mat-list-item routerLinkActive="active" routerLink="/products">
              <mat-icon matListItemIcon matTooltip="{{'mainMenu.Products' | translate}}" matTooltipPosition="right">swap_horiz</mat-icon>
            </a>
          }
          @if (canViewOrders) {
            <a mat-list-item routerLinkActive="active" routerLink="/orders">
              <mat-icon matListItemIcon matTooltip="{{'mainMenu.Orders' | translate}}" matTooltipPosition="right">monetization_on</mat-icon>
            </a>
          }
            <a mat-list-item routerLinkActive="active" routerLink="/products">
              <mat-icon matListItemIcon matTooltip="{{'mainMenu.Products' | translate}}" matTooltipPosition="right">watch_later</mat-icon>
            </a>
            <a mat-list-item routerLinkActive="active" routerLink="/products">
              <mat-icon matListItemIcon matTooltip="{{'mainMenu.Products' | translate}}" matTooltipPosition="right">note</mat-icon>
            </a>
          @if (canViewUsers || canViewRoles) {
            <mat-expansion-panel #admin [class.mat-elevation-z0]="!admin.expanded" hideToggle="true">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon matTooltip="{{'mainMenu.Admin' | translate}}" matTooltipPosition="right">settings</mat-icon>
                </mat-panel-title>
              </mat-expansion-panel-header>
              @if (canViewUsers) {
                <a mat-list-item routerLinkActive="active" routerLink="/admin/users">
                  <mat-icon matListItemIcon matTooltip="{{'mainMenu.Users' | translate}}" matTooltipPosition="right">people</mat-icon>
                </a>
              }
              @if (canViewRoles) {
                <a mat-list-item routerLinkActive="active" routerLink="/admin/roles">
                  <mat-icon matListItemIcon matTooltip="{{'mainMenu.Roles' | translate}}" matTooltipPosition="right">assignment_ind</mat-icon>
                </a>
              }
            </mat-expansion-panel>
          }
        </mat-nav-list>
      }
      <mat-nav-list>
        <a mat-list-item routerLinkActive="active" routerLink="/about">
          <mat-icon matListItemIcon matTooltip="{{'mainMenu.About' | translate}}" matTooltipPosition="right">info</mat-icon>
        </a>
      </mat-nav-list>
    </mat-sidenav>

    <mat-sidenav-content>
      <div class="flex-col fill">
        <div id="mainContent" class="flex-auto">
          <router-outlet></router-outlet>
        </div>
        <app-footer></app-footer>
      </div>
    </mat-sidenav-content>
  </mat-sidenav-container>

</div>

<ngx-toasta></ngx-toasta>
